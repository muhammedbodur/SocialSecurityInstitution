// Global flag ile script'in birden fazla y√ºklenmesini √∂nle
if (window.duzenleScriptLoaded) {
    // jQuery.getScript ile deƒüerlendirme sƒ±rasƒ±nda top-level return kullanƒ±lamaz.
    // ƒ∞kinci y√ºklemede unbindAllEvents() zaten tekrar baƒülamayƒ± g√ºvenle yapacak.
    console.warn('‚ö†Ô∏è duzenle.js already loaded! Continuing safely (no top-level return).');
} else {
    window.duzenleScriptLoaded = true;
}

$(window).on('load', function () {
    console.log('üîÑ duzenle.js window.load event fired');

    // Event handler sayƒ±sƒ±nƒ± kontrol et
    var existingHandlers = $._data($(document)[0], 'events');
    if (existingHandlers && existingHandlers.click) {
        console.log('üìä Existing click handlers on document:', existingHandlers.click.length);
    }

    // √ñnce t√ºm event handler'larƒ± temizle
    unbindAllEvents();

    // Select2 initialization
    if (typeof $.fn.select2 !== 'undefined') {
        $('.select2').select2({
            theme: 'bootstrap4',
            width: '100%'
        });
    }

    // Initialize cascade dropdowns
    initializeCascadeDropdowns();

    // Initialize form validation
    initializeFormValidation();

    // Load existing data for edit mode
    loadExistingDataForEdit();

    // Initialize real-time validation
    initializeRealTimeValidation();

    // Phone input class add
    $('#CepTelefonu, #CepTelefonu2, #EvTelefonu').addClass('phone-input');

    // Form native reset event'i dinle (click handler tetiklenmese bile √ßalƒ±≈üƒ±r)
    // Namespace ile baƒüla ve varlƒ±ƒüƒ±nƒ± logla
    $('#formAccountSettings').off('reset.duzenleForm').on('reset.duzenleForm', function () {
        console.log('üü° formAccountSettings reset event fired');
        // Bir sonraki tick'te Select2 UI'larƒ±nƒ± model ba≈ülangƒ±√ß deƒüerlerine senkronize et
        setTimeout(function () {
            try {
                $('.select2').each(function () {
                    // Mevcut deƒüeri koru ve Select2'yi haberdar et
                    $(this).trigger('change.select2');
                });
                clearAllErrors();
                showToast('info', 'Form sƒ±fƒ±rlandƒ±');
            } catch (err) {
                console.error('Reset sync error:', err);
            }
        }, 0);
    });
    console.log('‚úÖ Reset handlers attached');
});

// T√ºm event handler'larƒ± temizle
function unbindAllEvents() {
    console.log('üßπ Cleaning all events...');

    // Form submit event'ini temizle
    $('#formAccountSettings').off('submit');

    // Dropdown change event'lerini temizle
    $('#IlId, #EsininIsIlId, #DepartmanId, #MedeniDurumu').off('change');

    // Input event'lerini temizle
    $('#Email, .phone-input, #TcKimlikNo, #SicilNo, #Dahili, #OgrenimSuresi, #DogumTarihi, #KartNoAktiflikTarihi').off('blur input change');

    // Required fields event'lerini temizle
    $('input[required], select[required]').off('blur');

    // Reset button event'ini namespace ile temizle
    $(document).off('click.duzenleForm', 'button[type="reset"]');

    // T√ºm reset button handler'larƒ±nƒ± temizle (g√ºvenlik i√ßin)
    $('button[type="reset"]').off('click');

    console.log('‚úÖ All events cleaned');
}

function initializeCascadeDropdowns() {
    // ƒ∞l -> ƒ∞l√ße Cascade
    $('#IlId').off('change').on('change', function () {
        var ilId = $(this).val();
        loadIlceler(ilId, '#IlceId', 'ƒ∞l√ße se√ßiniz');
    });

    // E≈üinin ƒ∞l -> E≈üinin ƒ∞l√ße Cascade  
    $('#EsininIsIlId').off('change').on('change', function () {
        var ilId = $(this).val();
        loadIlceler(ilId, '#EsininIsIlceId', 'ƒ∞l√ße se√ßiniz');
    });

    // Departman -> Servis Cascade
    $('#DepartmanId').off('change').on('change', function () {
        var departmanId = $(this).val();
        loadServisler(departmanId);
        loadHizmetBinalari(departmanId);
    });

    // Medeni durum deƒüi≈ütiƒüinde e≈ü bilgilerini kontrol et
    $('#MedeniDurumu').off('change').on('change', function () {
        var medeniDurum = $(this).val();
        if (medeniDurum === '0') { // evli
            $('#EsininAdi').attr('required', true);
            showToast('info', 'Medeni durumu evli se√ßildi. E≈ü bilgilerini doldurmayƒ± unutmayƒ±n.');
        } else {
            $('#EsininAdi').removeAttr('required');
            clearError('#EsininAdi');
        }
    });
}

function loadHizmetBinalari(departmanId) {
    $.ajax({
        url: '/Personel/GetHizmetBinalariByDepartmanId',
        data: { departmanId: departmanId },
        success: function (data) {
            var $dropdown = $('#HizmetBinasiId');
            $dropdown.empty().append('<option value="">Se√ßiniz</option>');
            $.each(data, function () {
                $dropdown.append($('<option></option>').val(this.hizmetBinasiId).text(this.hizmetBinasiAdi));
            });

            if ($dropdown.hasClass('select2')) {
                $dropdown.trigger('change.select2');
            }
        },
        error: function (xhr, status, error) {
            console.error('Hizmet binalarƒ± y√ºklenirken hata:', error);
            showToast('error', 'Hizmet binalarƒ± y√ºklenirken hata olu≈ütu');
        }
    });
}

function loadIlceler(ilId, targetSelectId, emptyText) {
    var $target = $(targetSelectId);

    if (!ilId || ilId == '0' || ilId == '') {
        $target.empty().append('<option value="">' + emptyText + '</option>');
        if ($target.hasClass('select2')) {
            $target.trigger('change.select2');
        }
        clearError(targetSelectId);
        return;
    }

    // Loading state
    $target.prop('disabled', true);
    $target.empty().append('<option value="">Y√ºkleniyor...</option>');
    if ($target.hasClass('select2')) {
        $target.trigger('change.select2');
    }

    $.ajax({
        url: '/Personel/GetIlcelerByIlId',
        method: 'GET',
        data: { ilId: ilId },
        success: function (response) {
            var selectedValue = $target.data('selected-value');

            $target.empty().append('<option value="">' + emptyText + '</option>');

            if (response && response.length > 0) {
                $.each(response, function (index, item) {
                    var isSelected = selectedValue && selectedValue == item.ilceId ? 'selected' : '';
                    $target.append('<option value="' + item.ilceId + '" ' + isSelected + '>' + item.ilceAdi + '</option>');
                });
            }

            $target.prop('disabled', false);
            if ($target.hasClass('select2')) {
                $target.trigger('change.select2');
            }
            clearError(targetSelectId);
        },
        error: function (xhr, status, error) {
            console.error('ƒ∞l√ßeler y√ºklenirken hata:', error);
            $target.empty().append('<option value="">Hata olu≈ütu</option>');
            $target.prop('disabled', false);
            if ($target.hasClass('select2')) {
                $target.trigger('change.select2');
            }
            showToast('error', 'ƒ∞l√ßeler y√ºklenirken hata olu≈ütu');
            highlightError(targetSelectId);
        }
    });
}

function loadServisler(departmanId) {
    var $target = $('#ServisId');

    if (!departmanId || departmanId == '0') {
        $target.empty().append('<option value="">√ñnce departman se√ßiniz</option>');
        if ($target.hasClass('select2')) {
            $target.trigger('change.select2');
        }
        return;
    }

    var selectedValue = $target.data('selected-value');

    $target.prop('disabled', true);
    $target.empty().append('<option value="">Y√ºkleniyor...</option>');
    if ($target.hasClass('select2')) {
        $target.trigger('change.select2');
    }

    $.ajax({
        url: '/Personel/GetServislerByDepartmanId',
        method: 'GET',
        data: { departmanId: departmanId },
        success: function (response) {
            $target.empty().append('<option value="">Servis se√ßiniz</option>');

            if (response && response.length > 0) {
                $.each(response, function (index, item) {
                    var isSelected = selectedValue && selectedValue == item.id ? 'selected' : '';
                    $target.append('<option value="' + item.id + '" ' + isSelected + '>' + item.servisAdi + '</option>');
                });
            }

            $target.prop('disabled', false);
            if ($target.hasClass('select2')) {
                $target.trigger('change.select2');
            }
            clearError('#ServisId');
        },
        error: function (xhr, status, error) {
            console.error('Servisler y√ºklenirken hata:', error);
            $target.empty().append('<option value="">Hata olu≈ütu</option>');
            $target.prop('disabled', false);
            if ($target.hasClass('select2')) {
                $target.trigger('change.select2');
            }
            showToast('error', 'Servisler y√ºklenirken hata olu≈ütu');
            highlightError('#ServisId');
        }
    });
}

function loadExistingDataForEdit() {
    // ƒ∞l√ßeleri y√ºkle (edit mode)
    var ilId = $('#IlId').val();
    if (ilId && ilId !== '0') {
        loadIlceler(ilId, '#IlceId', 'ƒ∞l√ße se√ßiniz');
    }

    // E≈üinin il√ßelerini y√ºkle (edit mode)
    var esIlId = $('#EsininIsIlId').val();
    if (esIlId && esIlId !== '0') {
        loadIlceler(esIlId, '#EsininIsIlceId', 'ƒ∞l√ße se√ßiniz');
    }

    // Servisleri y√ºkle (edit mode)
    var departmanId = $('#DepartmanId').val();
    if (departmanId && departmanId !== '0') {
        loadServisler(departmanId);
    }
}

function initializeFormValidation() {
    $('#formAccountSettings').off('submit').on('submit', function (e) {
        // T√ºm hatalarƒ± temizle
        clearAllErrors();

        var isValid = true;

        // Cascade selections kontrol√º
        if (!validateCascadeSelections()) {
            isValid = false;
        }

        // Business rules kontrol√º
        if (!validateBusinessRules()) {
            isValid = false;
        }

        // Required field kontrol√º
        if (!validateRequiredFields()) {
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            showToast('error', 'L√ºtfen formdaki hatalarƒ± d√ºzeltin ve tekrar deneyin');
            return false;
        }

        // Form g√∂nderiliyor mesajƒ±
        showToast('info', 'Personel bilgileri g√ºncelleniyor...');
    });
}

function validateRequiredFields() {
    var isValid = true;
    var requiredFields = [
        { id: '#TcKimlikNo', name: 'T.C. Kimlik Numarasƒ±' },
        { id: '#AdSoyad', name: 'Ad Soyad' },
        { id: '#SicilNo', name: 'Sicil Numarasƒ±' },
        { id: '#DepartmanId', name: 'Departman' },
        { id: '#ServisId', name: 'Servis' },
        { id: '#UnvanId', name: '√únvan' },
        { id: '#AtanmaNedeniId', name: 'Atanma Nedeni' },
        { id: '#Email', name: 'E-mail' },
        { id: '#DogumTarihi', name: 'Doƒüum Tarihi' }
    ];

    for (var i = 0; i < requiredFields.length; i++) {
        var field = requiredFields[i];
        var value = $(field.id).val();
        if (!value || value === '' || value === '0') {
            highlightError(field.id);
            showToast('error', field.name + ' alanƒ± zorunludur');
            isValid = false;
        }
    }

    return isValid;
}

function validateCascadeSelections() {
    var isValid = true;
    var errors = [];

    // ƒ∞l se√ßilmi≈ü ama il√ße se√ßilmemi≈ü
    var ilId = $('#IlId').val();
    var ilceId = $('#IlceId').val();

    if (ilId && ilId !== '0' && (!ilceId || ilceId === '0')) {
        errors.push('ƒ∞l se√ßtikten sonra il√ße se√ßimi zorunludur');
        highlightError('#IlceId');
        isValid = false;
    }

    // E≈üinin ili se√ßilmi≈ü ama il√ßesi se√ßilmemi≈ü  
    var esIlId = $('#EsininIsIlId').val();
    var esIlceId = $('#EsininIsIlceId').val();

    if (esIlId && esIlId !== '0' && (!esIlceId || esIlceId === '0')) {
        errors.push('E≈ü i≈ü ili se√ßildikten sonra il√ße se√ßimi zorunludur');
        highlightError('#EsininIsIlceId');
        isValid = false;
    }

    // Departman se√ßilmi≈ü ama servis se√ßilmemi≈ü
    var departmanId = $('#DepartmanId').val();
    var servisId = $('#ServisId').val();

    if (departmanId && departmanId !== '0' && (!servisId || servisId === '0')) {
        errors.push('Departman se√ßildikten sonra servis se√ßimi zorunludur');
        highlightError('#ServisId');
        isValid = false;
    }

    for (var i = 0; i < errors.length; i++) {
        showToast('error', errors[i]);
    }

    return isValid;
}

function validateBusinessRules() {
    var isValid = true;
    var errors = [];

    // Doƒüum tarihi kontrol√º
    var dogumTarihi = new Date($('#DogumTarihi').val());
    var today = new Date();

    if (dogumTarihi && !isNaN(dogumTarihi.getTime())) {
        var age = today.getFullYear() - dogumTarihi.getFullYear();
        var monthDiff = today.getMonth() - dogumTarihi.getMonth();

        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dogumTarihi.getDate())) {
            age--;
        }

        if (age < 18) {
            errors.push('Personel en az 18 ya≈üƒ±nda olmalƒ±dƒ±r');
            highlightError('#DogumTarihi');
            isValid = false;
        }

        if (age > 70) {
            errors.push('Personel ya≈üƒ± 70\'den b√ºy√ºk olamaz');
            highlightError('#DogumTarihi');
            isValid = false;
        }

        if (dogumTarihi > today) {
            errors.push('Doƒüum tarihi gelecek tarih olamaz');
            highlightError('#DogumTarihi');
            isValid = false;
        }
    }

    // Kart aktiflik tarihi kontrol√º
    var kartTarihi = $('#KartNoAktiflikTarihi').val();
    if (kartTarihi && new Date(kartTarihi) > today) {
        errors.push('Kart aktiflik tarihi gelecek tarih olamaz');
        highlightError('#KartNoAktiflikTarihi');
        isValid = false;
    }

    // Medeni durumu kontrol√º
    var medeniDurum = $('#MedeniDurumu').val();
    var esininAdi = $('#EsininAdi').val();

    if (medeniDurum === '0' && (!esininAdi || esininAdi.trim() === '')) { // evli
        errors.push('Medeni durumu evli olan personelin e≈ü adƒ± zorunludur');
        highlightError('#EsininAdi');
        isValid = false;
    }

    // √ñƒürenim s√ºresi kontrol√º
    var ogrenimSuresi = parseInt($('#OgrenimSuresi').val());
    if (!isNaN(ogrenimSuresi) && ogrenimSuresi > 15) {
        errors.push('√ñƒürenim s√ºresi 15 yƒ±ldan fazla olamaz');
        highlightError('#OgrenimSuresi');
        isValid = false;
    }

    if (ogrenimSuresi < 0) {
        errors.push('√ñƒürenim s√ºresi negatif olamaz');
        highlightError('#OgrenimSuresi');
        isValid = false;
    }

    // Sicil numarasƒ± kontrol√º
    var sicilNo = parseInt($('#SicilNo').val());
    if (isNaN(sicilNo) || sicilNo <= 0) {
        errors.push('Ge√ßerli bir sicil numarasƒ± giriniz');
        highlightError('#SicilNo');
        isValid = false;
    }

    // Dahili telefon kontrol√º
    var dahili = parseInt($('#Dahili').val());
    if (!isNaN(dahili) && (dahili < 0 || dahili > 9999)) {
        errors.push('Dahili telefon 0-9999 arasƒ±nda olmalƒ±dƒ±r');
        highlightError('#Dahili');
        isValid = false;
    }

    for (var i = 0; i < errors.length; i++) {
        showToast('error', errors[i]);
    }

    return isValid;
}

function initializeRealTimeValidation() {
    // Email validation
    $('#Email').off('blur').on('blur', function () {
        var email = $(this).val();
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (email && email.trim() !== '') {
            if (!emailRegex.test(email)) {
                highlightError('#Email');
                showToast('warning', 'Ge√ßerli bir e-mail adresi giriniz');
            } else {
                clearError('#Email');
            }
        }
    });

    // Telefon validation
    $('.phone-input').off('input blur').on('input blur', function () {
        var phone = $(this).val();
        var phoneRegex = /^[0-9\s\-\+\(\)]{10,15}$/;

        if (phone && phone.trim() !== '') {
            if (!phoneRegex.test(phone.replace(/\s/g, ''))) {
                highlightError('#' + $(this).attr('id'));
                showToast('warning', 'Ge√ßerli bir telefon numarasƒ± giriniz');
            } else {
                clearError('#' + $(this).attr('id'));
            }
        } else {
            clearError('#' + $(this).attr('id'));
        }
    });

    // TC Kimlik No validation
    $('#TcKimlikNo').off('input').on('input', function () {
        var tc = $(this).val();
        if (tc && tc.length === 11 && /^\d+$/.test(tc)) {
            clearError('#TcKimlikNo');
        } else if (tc && tc.length > 0) {
            highlightError('#TcKimlikNo');
            if (tc.length !== 11) {
                showToast('warning', 'T.C. Kimlik No 11 haneli olmalƒ±dƒ±r');
            } else {
                showToast('warning', 'T.C. Kimlik No sadece rakam i√ßermelidir');
            }
        }
    });

    // Sicil No validation
    $('#SicilNo').off('input blur').on('input blur', function () {
        var sicilNo = $(this).val();
        if (sicilNo && sicilNo.trim() !== '') {
            var sicilInt = parseInt(sicilNo);
            if (isNaN(sicilInt) || sicilInt <= 0) {
                highlightError('#SicilNo');
                showToast('warning', 'Ge√ßerli bir sicil numarasƒ± giriniz');
            } else {
                clearError('#SicilNo');
            }
        }
    });

    // Dahili telefon validation
    $('#Dahili').off('input blur').on('input blur', function () {
        var dahili = $(this).val();
        if (dahili && dahili.trim() !== '') {
            var dahiliInt = parseInt(dahili);
            if (isNaN(dahiliInt) || dahiliInt < 0 || dahiliInt > 9999) {
                highlightError('#Dahili');
                showToast('warning', 'Dahili telefon 0-9999 arasƒ±nda olmalƒ±dƒ±r');
            } else {
                clearError('#Dahili');
            }
        }
    });

    // √ñƒürenim s√ºresi validation
    $('#OgrenimSuresi').off('input blur').on('input blur', function () {
        var sure = $(this).val();
        if (sure && sure.trim() !== '') {
            var sureInt = parseInt(sure);
            if (isNaN(sureInt) || sureInt < 0 || sureInt > 15) {
                highlightError('#OgrenimSuresi');
                showToast('warning', '√ñƒürenim s√ºresi 0-15 yƒ±l arasƒ±nda olmalƒ±dƒ±r');
            } else {
                clearError('#OgrenimSuresi');
            }
        }
    });

    // Doƒüum tarihi validation
    $('#DogumTarihi').off('change blur').on('change blur', function () {
        var dogumTarihi = new Date($(this).val());
        var today = new Date();

        if (dogumTarihi && !isNaN(dogumTarihi.getTime())) {
            if (dogumTarihi > today) {
                highlightError('#DogumTarihi');
                showToast('warning', 'Doƒüum tarihi gelecek tarih olamaz');
            } else {
                var age = today.getFullYear() - dogumTarihi.getFullYear();
                var monthDiff = today.getMonth() - dogumTarihi.getMonth();

                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dogumTarihi.getDate())) {
                    age--;
                }

                if (age < 18) {
                    highlightError('#DogumTarihi');
                    showToast('warning', 'Personel en az 18 ya≈üƒ±nda olmalƒ±dƒ±r');
                } else if (age > 70) {
                    highlightError('#DogumTarihi');
                    showToast('warning', 'Personel ya≈üƒ± 70\'den b√ºy√ºk olamaz');
                } else {
                    clearError('#DogumTarihi');
                }
            }
        }
    });

    // Kart aktiflik tarihi validation
    $('#KartNoAktiflikTarihi').off('change blur').on('change blur', function () {
        var kartTarihi = new Date($(this).val());
        var today = new Date();

        if (kartTarihi && !isNaN(kartTarihi.getTime())) {
            if (kartTarihi > today) {
                highlightError('#KartNoAktiflikTarihi');
                showToast('warning', 'Kart aktiflik tarihi gelecek tarih olamaz');
            } else {
                clearError('#KartNoAktiflikTarihi');
            }
        }
    });

    // Required fields i√ßin focus out kontrol√º
    $('input[required], select[required]').off('blur').on('blur', function () {
        var value = $(this).val();
        if (!value || value.trim() === '' || value === '0') {
            highlightError('#' + $(this).attr('id'));
        } else {
            clearError('#' + $(this).attr('id'));
        }
    });

    // ƒ∞l-ƒ∞l√ße real-time validation
    $('#IlId').off('change').on('change', function () {
        var ilId = $(this).val();
        var ilceId = $('#IlceId').val();

        if (ilId && ilId !== '0') {
            clearError('#IlId');
            if (ilceId && ilceId !== '0') {
                clearError('#IlceId');
            }
        }
    });

    $('#EsininIsIlId').off('change').on('change', function () {
        var ilId = $(this).val();
        var ilceId = $('#EsininIsIlceId').val();

        if (ilId && ilId !== '0') {
            clearError('#EsininIsIlId');
            if (ilceId && ilceId !== '0') {
                clearError('#EsininIsIlceId');
            }
        }
    });
}

function highlightError(selector) {
    $(selector).addClass('is-invalid');
    $(selector).removeClass('is-valid');

    // Select2 elementleri i√ßin √∂zel styling
    if ($(selector).hasClass('select2')) {
        $(selector).next('.select2-container').find('.select2-selection').addClass('is-invalid');
        $(selector).next('.select2-container').find('.select2-selection').removeClass('is-valid');
    }
}

function clearError(selector) {
    $(selector).removeClass('is-invalid');
    $(selector).addClass('is-valid');

    // Select2 elementleri i√ßin √∂zel styling
    if ($(selector).hasClass('select2')) {
        $(selector).next('.select2-container').find('.select2-selection').removeClass('is-invalid');
        $(selector).next('.select2-container').find('.select2-selection').addClass('is-valid');
    }
}

function clearAllErrors() {
    $('.form-control, .form-select').removeClass('is-invalid is-valid');
    $('.select2-container .select2-selection').removeClass('is-invalid is-valid');
}

function showToast(type, message) {
    if (typeof toastr !== 'undefined') {
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        toastr[type](message);
    } else if (typeof Swal !== 'undefined') {
        var icon = 'info';
        switch (type) {
            case 'error': icon = 'error'; break;
            case 'success': icon = 'success'; break;
            case 'warning': icon = 'warning'; break;
            default: icon = 'info'; break;
        }

        Swal.fire({
            icon: icon,
            title: message,
            timer: 3000,
            showConfirmButton: false,
            toast: true,
            position: 'top-end'
        });
    } else {
        alert(message);
    }
}

// Form temizleme onayƒ± - Document level event handler - Namespace kullan ve debug ekle
$(document).off('click.duzenleForm', 'button[type="reset"]').on('click.duzenleForm', 'button[type="reset"]', function (e) {
    console.log('üî¥ Reset button clicked! Handler count check...');

    // Inline onclick varsa kaldƒ±r (g√ºvenlik √∂nlemi)
    $(this).removeAttr('onclick');

    // Handler sayƒ±sƒ±nƒ± kontrol et
    var handlers = $._data($(document)[0], 'events');
    if (handlers && handlers.click) {
        var resetHandlers = handlers.click.filter(h => h.selector === 'button[type="reset"]');
        console.log('üìä Reset button handlers count:', resetHandlers.length);

        if (resetHandlers.length > 1) {
            console.error('‚ùå Multiple handlers detected!', resetHandlers);
        }
    }

    e.preventDefault();
    e.stopPropagation();

    if (typeof Swal !== 'undefined') {
        Swal.fire({
            title: 'Emin misiniz?',
            text: 'Formu temizlemek istediƒüinize emin misiniz? Doldurduƒüunuz t√ºm veriler silinecek.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Evet, temizle!',
            cancelButtonText: 'ƒ∞ptal'
        }).then((result) => {
            if (result.isConfirmed) {
                // Native reset tetikle (reset event handler Select2 ve validasyonlarƒ± senkronize edecek)
                $('#formAccountSettings')[0].reset();
                showToast('success', 'Form temizlendi');
            }
        });
    } else {
        var confirmed = confirm('Formu temizlemek istediƒüinize emin misiniz? Doldurduƒüunuz t√ºm veriler silinecek.');
        if (confirmed) {
            // Native reset tetikle (reset event handler Select2 ve validasyonlarƒ± senkronize edecek)
            $('#formAccountSettings')[0].reset();
            showToast('success', 'Form temizlendi');
        }
    }
});